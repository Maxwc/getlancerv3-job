"use strict";angular.module("getlancerApp.Job.ResumeRating",["ngResource","ngSanitize","satellizer","ngAnimate","ui.bootstrap","ui.bootstrap.datetimepicker","ui.router","angular-growl","google.places","angular.filter","ngCookies","angular-md5","http-auth-interceptor","angulartics","pascalprecht.translate","angulartics.google.analytics","tmh.dynamicLocale","ngFileUpload","angular-loading-bar","ngAnimate","checklist-model","angularjs-dropdown-multiselect","ngTagsInput","textAngular"]),angular.module("getlancerApp.Job.ResumeRating").controller("ResumeRatingController",function($scope,$rootScope,$filter,md5,$state,DateFormat,ResumeRatingGetFactory,ResumeRatingAddFactory,ResumeRatingFactory,$cookies,StarCount,flash,$location){function init(){$scope.StarCount=StarCount,$scope.DateFormat=DateFormat,$scope.comment={},$scope.resumeRatingGet(),$scope.is_rating_req=!1,$scope.isEdit=!1}$scope.DateFormat=DateFormat,$scope.resumeRatingDelete=function(id){var flashMessage="";null!==$rootScope.user&&void 0!==$rootScope.user&&swal({title:$filter("translate")("Are you sure you want to delete?"),type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"OK",cancelButtonText:"Cancel",closeOnConfirm:!0,animation:!1}).then(function(isConfirm){if(isConfirm){var params={};params.id=id,ResumeRatingFactory["delete"](params,function(response){0===response.error.code?(flashMessage=$filter("translate")("Comment deleted successfully."),flash.set(flashMessage,"success",!1)):(flashMessage=$filter("translate")(response.error.message),flash.set(flashMessage,"error",!1)),$state.go("applies_jobs_view",{},{reload:!0})})}})},$scope.resumeRatingGet=function(){ResumeRatingGetFactory.get({id:$state.params.id},function(response){$scope.resumeRatings=response.data,angular.forEach($scope.resumeRatings,function(value){angular.isDefined(value.user.attachment)&&null!==value.user.attachment?$scope.resumeRatings.logo_url="images/normal_thumb/UserAvatar/"+value.user.attachment.foreign_id+"."+md5.createHash("UserAvatar"+value.user.attachment.foreign_id+"pngnormal_thumb")+".png":$scope.resumeRatings.logo_url="images/default.png"})})},$scope.save_btn=!1,$scope.commentAdd=function($valid){if($valid)if($scope.save_btn=!0,parseInt($scope.comment.rating_select)>0){$scope.is_rating_req=!1;var post_params={job_id:$scope.job_apply_status_view.job_id,job_apply_id:$state.params.id,rating:$scope.comment.rating_select,comment:$scope.comment.resumeComment},flashMessage="";$scope.isEdit?(post_params.id=$scope.reviewId,ResumeRatingFactory.put(post_params,function(response){$scope.response=response,0===$scope.response.error.code?($scope.isEdit=!1,$scope.comment={},$scope.applyComment.$setPristine(),$scope.applyComment.$setUntouched(),flashMessage=$filter("translate")("Comment updated successfully."),flash.set(flashMessage,"success",!1),$state.reload()):(flashMessage=$filter("translate")($scope.response.error.message),flash.set(flashMessage,"error",!1))})):ResumeRatingAddFactory.post(post_params,function(response){$scope.response=response,0===$scope.response.error.code?($scope.comment={},$scope.applyComment.$setPristine(),$scope.applyComment.$setUntouched(),flashMessage=$filter("translate")("Comment added successfully."),flash.set(flashMessage,"success",!1),$state.reload()):(flashMessage=$filter("translate")($scope.response.error.message),flash.set(flashMessage,"error",!1),$scope.save_btn=!1)})}else $scope.is_rating_req=!0},$scope.starCount=function(starCountVal){$scope.comment.rating_select=starCountVal},$scope.editReview=function(reviewId){$scope.isEdit=!0,$scope.reviewId=reviewId,ResumeRatingFactory.get({id:$scope.reviewId},function(resp){$scope.comment={},$scope.comment.rating_select=resp.data.rating,$scope.comment.resumeComment=resp.data.comment})},init()}),angular.module("getlancerApp.Job.ResumeRating").directive("resumeRatingView",function(){return{templateUrl:"scripts/plugins/Job/ResumeRating/views/default/job_resume_rating_view.html",restrict:"E",controller:"ResumeRatingController"}}),angular.module("getlancerApp.Job.ResumeRating").factory("ResumeRatingGetFactory",["$resource",function($resource){return $resource("/api/v1/job_apply/:id/resume_ratings",{},{get:{method:"GET"}})}]).factory("ResumeRatingAddFactory",["$resource",function($resource){return $resource("/api/v1/resume_ratings",{},{post:{method:"POST"}})}]).factory("ResumeRatingFactory",["$resource",function($resource){return $resource("/api/v1/resume_ratings/:id",{id:"@id"},{get:{method:"GET"},"delete":{method:"DELETE"},put:{method:"PUT"}})}]),angular.module("getlancerApp.Job.ResumeRating").run(["$templateCache",function($templateCache){$templateCache.put("scripts/plugins/Job/ResumeRating/views/default/job_resume_rating_view.html",'<div> <div class="resume-view lin-heig22"> <div class="media" ng-repeat="resumeRating in resumeRatings"> <div class="navbar-left"> <a href="#" title="Megv"><img ng-src="{{resumeRatings.logo_url}}" alt="[Images: Megv]" title="{{resumeRating.user.username}}" class="user-med"></a> </div> <div class="media-body"> <div class="row"> <div class="col-md-10"> <p class="no-mar"> <a ui-sref="user_profile({id:resumeRating.user.id,slug:resumeRating.user.username})"> <span>{{resumeRating.user.username}}</span> </a> <small class="ver-lft-space5 grayc">- {{resumeRating.created_at | date_format : DateFormat.view}}</small> </p> <p class="grayc">{{resumeRating.comment}}</p> <span class="grayc">{{\'Rating\'|translate}}</span> <div class="star-rating navbar-btn"> <input-stars ng-model="resumeRating.rating" max="{{StarCount.JobsResume}}" readonly></input-stars> </div> </div> <div class="col-md-2"> <div class="text-danger"> <a href="javascript:void(0);" class="btn btn-danger btn-sm" ng-click="resumeRatingDelete(resumeRating.id);$event.stopPropagation()"><i class="fa fa-trash fa-fw" aria-hidden="true"></i> Delete</a> </div> </div> </div> </div> </div> <div class="media"> <div class="navbar-left media-top"> <img ng-src="{{resumeRatings.logo_url}}" alt="[Image: User]" class="user-med" ng-if="resumeRatings.length > 0"> <img ng-src="{{user.userimage}}" alt="[Image: User]" class="user-med" ng-if="resumeRatings.length == 0"> </div> <div class="media-body"> <form name="applyComment" role="form" ng-submit="commentAdd(applyComment.$valid)" novalidate> <div class="form-group"> <label class="grayc">{{\'Rating\'|translate}}</label> <span class="dc star-rating cursor"> <input-stars ng-model="comment.rating_select" max="{{StarCount.JobsResume}}" on-star-click="starCount(comment.rating_select)" name="rathing" required></input-stars> <span class="error" ng-show="(applyComment.$submitted || applyComment.rathing.$touched) && (applyComment.rathing.$pristine || applyComment.rathing.$invalid) && (applyComment.rathing.$error.required)"> {{\'Required\'| translate }}</span> </span> <div class="row"> <div class="col-sm-10"> <label for="comments1" class="sr-only">comment</label> <textarea type="text" rows="5" name="inputComment" ng-model="comment.resumeComment" class="form-control" id="inputComment" ng-required="true"></textarea> <span class="error" ng-show="(applyComment.$submitted || applyComment.inputComment.$touched) && (applyComment.inputComment.$pristine || applyComment.inputComment.$invalid) && (applyComment.inputComment.$error.required)"> {{\'Required\'| translate }} </span> </div> </div> </div> <div class="clearfix"> <ul class="list-inline"> <li> <button ng-show="save_btn" class="btn btn-primary btn-send bor-radi24" disabled>{{\'Submit\'|translate}}</button> <button type="submit" class="btn btn-primary btn-send bor-radi24" ng-show="!save_btn">{{\'Submit\'|translate}}</button> </li> </ul> </div> </form> </div> </div> </div> </div>')}]);